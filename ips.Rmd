---
title: "Costa Rica: IPS Cantonal"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
require(tidyr)
require(dplyr)
require(ggplot2)
require(plotly)
require(DT)

# ips <- read.csv("./inputs/cr-IPS-cantonal.csv", stringsAsFactors=FALSE)
ips <- readRDS("ips_ampliado.Rds")

indices <- names(ips)[4:dim(ips)[2]]
indices <- gsub("\\."," ",indices)
```

Indices - Box Plots
=======================================================================

Inputs {.sidebar}
-----------------------------------------------------------------------

```{r}
selectInput("indice", label = h3("Indice"),
    choices = indices,
    selected = 1)

selectInput("enColor", label = h3("Variable del color:"),
    choices = c("Provincia.y","UrbanoRural","AM","GAM"),
    selected = 1)
```

Se observa el comportamiento de cada indicador por provincia.

Row
-----------------------------------------------------------------------

### Box Plot

```{r}
indi <- reactive({gsub(" ","\\.",input$indice)})
enColor <- reactive(input$enColor)

tmp <- reactive({
  tmp0 <- ips[,c(indi(),enColor(),"Cantón")]
  names(tmp0)[1] <- "Indice"
  tmp0
  })

renderPlotly({
  plot_ly(tmp(), y = Indice, color = as.factor(ips[,enColor()]), type = "box")
})
```

Indices - Scatter Plots
=======================================================================

Inputs {.sidebar}
-----------------------------------------------------------------------

```{r}
selectInput("enX", label = h3("Variable en eje x:"),
    choices = indices,
    selected = 1)

selectInput("enY", label = h3("Variable en eje y:"),
    choices = indices,
    selected = 2)

selectInput("enColor", label = h3("Variable del color:"),
    choices = c("Provincia.y","UrbanoRural","AM","GAM"),
    selected = 1)
```

Se observa el comportamiento de la relación entre dos indicadores.

Row
-----------------------------------------------------------------------

### Box Plot

```{r}
enX_call <- reactive(gsub(" ","\\.",input$enX))
enY_call <- reactive(gsub(" ","\\.",input$enY))
enColor <- reactive(input$enColor)

renderPlotly({
  plot1 <- ggplot(data = ips, aes(x = ips[,enX_call()], y = ips[,enY_call()])) +
    geom_point(aes(colour=ips[,enColor()])) +
    xlab(input$enX) +
    ylab(input$enY) +
    ggtitle(paste(input$enX,"vs",input$enY))
  ggplotly(plot1)
  })
```

Indices - Datos
=======================================================================

Inputs
-----------------------------------------------------------------------

```{r}
renderDataTable({
  datatable(ips)
})
```
